# Observers

- Remark: Observers watch procedures, and handle events


When a [Procedure](Classes\/Procedure.html) is added to a [queue](Classes\/ProcedureQueue.html), it moves through its own internal state, as discussed in [Scheduling](Classes\Scheduling.html). Key transitions between these states are referred to as events, and each state transition can be observed.

Observers are attached to the procedure. When an event occurs, the method equivalent to the state transition will be invoked. The [ProcedureObserver protocol](Protocols\/ProcedureObserver.html) defines all the methods, and there are empty default implementations provided. This is because typically an observer is only for a particular transition, such as the procedure cancelling or finishing.

## Possible Observers

| Method   | Event Description |
|----------------|:--------------------------:|
| `didAttach(to:)` | When the observer is attached to a procedure. |
| `did(execute:)`  | After the procedure calls its `execute` method. |
| `did(cancel:withErrors:)`  | After the procedure cancels. |
| `procedure(_:willAdd:)`  | When the procedure will spawn a new `Operation`. |
| `procedure(_:didAdd:)`  | After the procedure did spawn a new `Operation`. |
| `will(finish:withErrors:pendingFinish:)`  | When the procedure will finish. |
| `did(finish:withErrors:)`  | After the procedure did finish. |


## "Will" vs. "Did" Observers:

It is important to understand the purpose of both common observer prefixes, and the guarantees that the ProcedureKit framework makes:

- Will(X) observers are called **before an event occurs**.

> Examples:

> All "WillFinish" observers are called before the Procedure's internal state transitions to finished.

- Did(X) observers are called **at some point after an event occurs**.

> Example:

> All "DidExecute" observers are called after the Procedure's `execute()` function returns.

> However, other observers may be called *prior* to the "DidExecute" observer (depending on the order that events occur).

### Observers and Thread-safety:

- Important: An observer will never be called concurrently with other Procedure events (or observers) generated by a Procedure.

If you register multiple observers (for example: a DidExecute observer and a DidFinish observer) on a Procedure, they will not be called concurrently.

**However**, no such guarantee is made between Procedures. Hence, if you register an observer on `ProcedureA` and an observer on `ProcedureB`, both observers access/modify the same data, and both Procedures may execute concurrently, you should ensure that those accesses are thread-safe or support concurrency. (Or in other words, avoid shared state without the appropriate locking mechanisms)